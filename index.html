<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Шифровальщик</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --primary: #334155;
            --secondary: #e2e8f0;
            --text-color: #334155;
            --background: #f8fafc;
            --card-bg: #cbd5e1;
            --switch-bg-on: #334155;
            --switch-bg-off: #cbd5e1;
            --switch-ball: #ffffff;
            --modal-bg: rgba(0, 0, 0, 0.5);
            --modal-card: #f1f5f9;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        
        .container {
            width: 100%;
            max-width: 700px;
        }

        .card {
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .easy-card { background-color: #d1fae5; }
        .medium-card { background-color: #fef9c3; }
        .hard-card { background-color: #fee2e2; }
        
        .easy-header { color: #065f46; }
        .medium-header { color: #a16207; }
        .hard-header { color: #991b1b; }

        h1, h2, h3 {
            font-weight: 700;
        }
        
        .main-header { color: var(--primary); }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            background: var(--secondary);
            outline: none;
            opacity: 0.8;
            transition: opacity .2s;
            border-radius: 5px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: var(--primary);
            cursor: pointer;
            border-radius: 50%;
            border: 4px solid white;
        }

        .copy-btn {
            background-color: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .copy-btn:hover {
            background-color: #64748b;
        }

        .copy-btn:active {
            transform: scale(0.95);
        }

        .text-output {
            background-color: white;
            min-height: 5rem;
            max-height: 10rem;
            overflow-y: auto;
            border-radius: 1rem;
            padding: 1rem;
            border: 2px solid #e2e8f0;
        }
        
        .input-field {
            background-color: white;
            border: 2px solid #e2e8f0;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        
        .input-field:focus {
            border-color: #94a3b8;
            box-shadow: 0 0 0 3px rgba(148, 163, 184, 0.5);
        }

        /* Стили для нового переключателя */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0; /* Увеличил отступы */
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 80px; /* Увеличил ширину */
            height: 40px; /* Увеличил высоту */
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--switch-bg-off);
            transition: .4s;
            border-radius: 40px; /* Увеличил радиус */
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 32px; /* Увеличил размер шарика */
            width: 32px; /* Увеличил размер шарика */
            left: 4px;
            bottom: 4px;
            background-color: var(--switch-ball);
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--switch-bg-on);
        }

        input:checked + .slider:before {
            transform: translateX(40px); /* Увеличил сдвиг */
        }

        .toggle-label {
            font-size: 1.25rem; /* Увеличил шрифт */
            font-weight: 500;
        }

        /* Стили для модального окна */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: var(--modal-bg);
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal-content {
            background-color: var(--modal-card);
            margin: auto;
            padding: 2rem;
            border-radius: 1.5rem;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: #6b7280;
        }

        .close-btn:hover {
            color: #1f2937;
        }

        /* Стили для кнопки-вопросика */
        .info-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #6b7280;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: background-color 0.2s ease;
        }

        .info-btn:hover {
            background-color: #4b5563;
        }

        .cipher-header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

    </style>
</head>
<body>
    <div class="container flex flex-col items-center gap-6 p-4">
        <h1 class="text-4xl text-center main-header">Простой шифровальщик</h1>

        <!-- Переключатель режима -->
        <div class="toggle-container">
            <span id="encryptLabel" class="toggle-label text-gray-800">Зашифровать</span>
            <label class="toggle-switch">
                <input type="checkbox" id="modeSwitch">
                <span class="slider"></span>
            </label>
            <span id="decryptLabel" class="toggle-label text-gray-400">Расшифровать</span>
        </div>

        <!-- Основной блок ввода -->
        <div class="card bg-white w-full">
            <h2 class="text-2xl mb-4 text-center main-header">Ваше сообщение</h2>
            <textarea id="msgInp" placeholder="Введите ваше сообщение здесь..."
                      class="w-full h-32 p-4 text-lg rounded-xl input-field focus:outline-none transition-shadow"
            ></textarea>
            
            <div class="mt-6">
                <h2 class="text-2xl mb-2 text-center main-header">Опциональный пароль</h2>
                <input type="text" id="passInp" placeholder="Пароль для сложных шифров"
                       class="w-full p-4 text-lg rounded-xl input-field focus:outline-none transition-shadow"
                >
            </div>
        </div>
        
        <h2 id="section-header" class="text-3xl text-center main-header font-bold" style="min-height: 48px; display: flex; align-items: center; justify-content: center;">Зашифрованные сообщения</h2>

        <!-- Раздел для шифрования -->
        <div id="ciphers-enc" class="w-full flex flex-col gap-6">

            <h2 class="text-3xl text-center easy-header font-bold">Простые шифры</h2>

            <!-- Реверс текста -->
            <div class="card easy-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl easy-header">Реверс текста</h3>
                    <span class="info-btn" data-cipher="reverse">?</span>
                </div>
                <div id="reverseOut" class="text-output mt-2"></div>
            </div>
            
            <!-- Шифр Атбаш -->
            <div class="card easy-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl easy-header">Шифр Атбаш</h3>
                    <span class="info-btn" data-cipher="atbash">?</span>
                </div>
                <div id="atbashOut" class="text-output mt-2"></div>
            </div>
            
            <!-- ROT13 -->
            <div class="card easy-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl easy-header">ROT13</h3>
                    <span class="info-btn" data-cipher="rot13">?</span>
                </div>
                <div id="rot13Out" class="text-output mt-2"></div>
            </div>

            <!-- Шифр Цезаря -->
            <div class="card easy-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl easy-header">Шифр Цезаря</h3>
                    <span class="info-btn" data-cipher="caesar">?</span>
                </div>
                <div id="caesarOut" class="text-output mt-2"></div>
                <label for="caesarSlide" class="block my-2 text-sm">Сдвиг: <span id="caesarVal">3</span></label>
                <input type="range" id="caesarSlide" min="1" max="32" value="3" class="w-full">
            </div>

            <h2 class="text-3xl text-center medium-header mt-8 font-bold">Средние шифры</h2>

            <!-- Шифр Полибия -->
            <div class="card medium-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl medium-header">Шифр Полибия</h3>
                    <span class="info-btn" data-cipher="polybius">?</span>
                </div>
                <div id="polybiusOut" class="text-output mt-2"></div>
            </div>

            <!-- Зигзаг шифр -->
            <div class="card medium-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl medium-header">Зигзаг шифр</h3>
                    <span class="info-btn" data-cipher="zigzag">?</span>
                </div>
                <div id="zigzagOut" class="text-output mt-2"></div>
                <label for="zigzagSlide" class="block my-2 text-sm">Ряды: <span id="zigzagVal">3</span></label>
                <input type="range" id="zigzagSlide" min="2" max="10" value="3" class="w-full">
            </div>

            <!-- Шифр Виженера -->
            <div class="card medium-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl medium-header">Шифр Виженера</h3>
                    <span class="info-btn" data-cipher="vigenere">?</span>
                </div>
                <div id="vigenereOut" class="text-output mt-2"></div>
            </div>

            <!-- XOR шифр -->
            <div class="card medium-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl medium-header">XOR шифр</h3>
                    <span class="info-btn" data-cipher="xor">?</span>
                </div>
                <div id="xorOut" class="text-output mt-2"></div>
            </div>

            <h2 class="text-3xl text-center hard-header mt-8 font-bold">Сложные шифры</h2>
            
            <!-- Base64 -->
            <div class="card hard-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl hard-header">Base64</h3>
                    <span class="info-btn" data-cipher="base64">?</span>
                </div>
                <div id="base64Out" class="text-output mt-2"></div>
            </div>

            <!-- Шифр AES (128-bit) -->
            <div class="card hard-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl hard-header">Шифр AES (128-bit)</h3>
                    <span class="info-btn" data-cipher="aes128">?</span>
                </div>
                <div id="aes128Out" class="text-output mt-2"></div>
            </div>

            <!-- Шифр AES (256-bit) -->
            <div class="card hard-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl hard-header">Шифр AES (256-bit)</h3>
                    <span class="info-btn" data-cipher="aes256">?</span>
                </div>
                <div id="aes256Out" class="text-output mt-2"></div>
            </div>
            
            <!-- Полиалфавитный шифр -->
            <div class="card hard-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl hard-header">Полиалфавитный шифр</h3>
                    <span class="info-btn" data-cipher="polyalphabetic">?</span>
                </div>
                <div id="polyalphabeticOut" class="text-output mt-2"></div>
            </div>
        </div>

        <!-- Раздел для расшифровки -->
        <div id="ciphers-dec" class="w-full flex flex-col gap-6" style="display: none;">
            
            <h2 class="text-3xl text-center easy-header font-bold">Простые шифры</h2>

            <!-- Реверс текста -->
            <div class="card easy-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl easy-header">Реверс текста</h3>
                    <span class="info-btn" data-cipher="reverse">?</span>
                </div>
                <div id="reverseDecOut" class="text-output mt-2"></div>
            </div>

            <!-- Шифр Атбаш -->
            <div class="card easy-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl easy-header">Шифр Атбаш</h3>
                    <span class="info-btn" data-cipher="atbash">?</span>
                </div>
                <div id="atbashDecOut" class="text-output mt-2"></div>
            </div>

            <!-- ROT13 -->
            <div class="card easy-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl easy-header">ROT13</h3>
                    <span class="info-btn" data-cipher="rot13">?</span>
                </div>
                <div id="rot13DecOut" class="text-output mt-2"></div>
            </div>

            <!-- Шифр Цезаря -->
            <div class="card easy-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl easy-header">Шифр Цезаря</h3>
                    <span class="info-btn" data-cipher="caesar">?</span>
                </div>
                <div id="caesarDecOut" class="text-output mt-2"></div>
                <label for="caesarSlide" class="block my-2 text-sm">Сдвиг: <span id="caesarValDec">3</span></label>
                <input type="range" id="caesarSlideDec" min="1" max="32" value="3" class="w-full">
            </div>

            <h2 class="text-3xl text-center medium-header mt-8 font-bold">Средние шифры</h2>

            <!-- Шифр Полибия -->
            <div class="card medium-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl medium-header">Шифр Полибия</h3>
                    <span class="info-btn" data-cipher="polybius">?</span>
                </div>
                <div id="polybiusDecOut" class="text-output mt-2"></div>
            </div>

            <!-- Зигзаг шифр -->
            <div class="card medium-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl medium-header">Зигзаг шифр</h3>
                    <span class="info-btn" data-cipher="zigzag">?</span>
                </div>
                <div id="zigzagDecOut" class="text-output mt-2"></div>
                <label for="zigzagSlideDec" class="block my-2 text-sm">Ряды: <span id="zigzagValDec">3</span></label>
                <input type="range" id="zigzagSlideDec" min="2" max="10" value="3" class="w-full">
            </div>

            <!-- Шифр Виженера -->
            <div class="card medium-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl medium-header">Шифр Виженера</h3>
                    <span class="info-btn" data-cipher="vigenere">?</span>
                </div>
                <div id="vigenereDecOut" class="text-output mt-2"></div>
            </div>

            <!-- XOR шифр -->
            <div class="card medium-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl medium-header">XOR шифр</h3>
                    <span class="info-btn" data-cipher="xor">?</span>
                </div>
                <div id="xorDecOut" class="text-output mt-2"></div>
            </div>

            <h2 class="text-3xl text-center hard-header mt-8 font-bold">Сложные шифры</h2>

            <!-- Base64 -->
            <div class="card hard-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl hard-header">Base64</h3>
                    <span class="info-btn" data-cipher="base64">?</span>
                </div>
                <div id="base64DecOut" class="text-output mt-2"></div>
            </div>

            <!-- Шифр AES (128-bit) -->
            <div class="card hard-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl hard-header">Шифр AES (128-bit)</h3>
                    <span class="info-btn" data-cipher="aes128">?</span>
                </div>
                <div id="aes128DecOut" class="text-output mt-2"></div>
            </div>

            <!-- Шифр AES (256-bit) -->
            <div class="card hard-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl hard-header">Шифр AES (256-bit)</h3>
                    <span class="info-btn" data-cipher="aes256">?</span>
                </div>
                <div id="aes256DecOut" class="text-output mt-2"></div>
            </div>

            <!-- Полиалфавитный шифр -->
            <div class="card hard-card">
                <div class="cipher-header-container">
                    <h3 class="text-2xl hard-header">Полиалфавитный шифр</h3>
                    <span class="info-btn" data-cipher="polyalphabetic">?</span>
                </div>
                <div id="polyalphabeticDecOut" class="text-output mt-2"></div>
            </div>
        </div>

        <!-- Кнопки выровнены в ряд -->
        <div class="w-full flex justify-center gap-4 mt-4">
            <button class="copy-btn" onclick="copyAll()">Скопировать все</button>
            <button class="copy-btn" onclick="clearAll()">Очистить</button>
        </div>

        <!-- Модальное окно для подсказок -->
        <div id="infoModal" class="modal">
            <div class="modal-content">
                <span class="close-btn" id="closeModal">&times;</span>
                <h3 id="modalTitle" class="text-2xl font-bold mb-4"></h3>
                <p id="modalText" class="text-base"></p>
            </div>
        </div>

    </div>

    <script>
        const msgInp = document.getElementById('msgInp');
        const passInp = document.getElementById('passInp');
        const caesarSlide = document.getElementById('caesarSlide');
        const caesarVal = document.getElementById('caesarVal');
        const zigzagSlide = document.getElementById('zigzagSlide');
        const zigzagVal = document.getElementById('zigzagVal');
        
        const modeSwitch = document.getElementById('modeSwitch');
        const encryptLabel = document.getElementById('encryptLabel');
        const decryptLabel = document.getElementById('decryptLabel');
        
        const sectionHeader = document.getElementById('section-header');
        const ciphersEnc = document.getElementById('ciphers-enc');
        const ciphersDec = document.getElementById('ciphers-dec');

        const caesarSlideDec = document.getElementById('caesarSlideDec');
        const caesarValDec = document.getElementById('caesarValDec');
        const zigzagSlideDec = document.getElementById('zigzagSlideDec');
        const zigzagValDec = document.getElementById('zigzagValDec');
        
        let isEncrypting = true;

        const reverseOut = document.getElementById('reverseOut');
        const atbashOut = document.getElementById('atbashOut');
        const rot13Out = document.getElementById('rot13Out');
        const caesarOut = document.getElementById('caesarOut');
        const polybiusOut = document.getElementById('polybiusOut');
        const zigzagOut = document.getElementById('zigzagOut');
        const vigenereOut = document.getElementById('vigenereOut');
        const xorOut = document.getElementById('xorOut');
        const base64Out = document.getElementById('base64Out');
        const aes128Out = document.getElementById('aes128Out');
        const aes256Out = document.getElementById('aes256Out');
        const polyalphabeticOut = document.getElementById('polyalphabeticOut');

        const reverseDecOut = document.getElementById('reverseDecOut');
        const atbashDecOut = document.getElementById('atbashDecOut');
        const rot13DecOut = document.getElementById('rot13DecOut');
        const caesarDecOut = document.getElementById('caesarDecOut');
        const polybiusDecOut = document.getElementById('polybiusDecOut');
        const zigzagDecOut = document.getElementById('zigzagDecOut');
        const vigenereDecOut = document.getElementById('vigenereDecOut');
        const xorDecOut = document.getElementById('xorDecOut');
        const base64DecOut = document.getElementById('base64DecOut');
        const aes128DecOut = document.getElementById('aes128DecOut');
        const aes256DecOut = document.getElementById('aes256DecOut');
        const polyalphabeticDecOut = document.getElementById('polyalphabeticDecOut');

        // Модальное окно и кнопки
        const infoModal = document.getElementById('infoModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalText = document.getElementById('modalText');
        const closeModalBtn = document.getElementById('closeModal');
        const infoBtns = document.querySelectorAll('.info-btn');

        const cipherExplanations = {
            reverse: {
                title: "Реверс текста",
                text: "Это самый простой шифр! Он просто переворачивает твоё сообщение задом наперёд. Например, слово 'Привет' превратится в 'тевирП'."
            },
            atbash: {
                title: "Шифр Атбаш",
                text: "Этот шифр меняет каждую букву на её 'зеркальное' отражение в алфавите. Первая буква меняется на последнюю, вторая на предпоследнюю и так далее. Например, 'А' становится 'Я', а 'Б' — 'Ю'."
            },
            rot13: {
                title: "ROT13",
                text: "Очень хитрый шифр! Каждая буква сдвигается на 13 мест вперёд по алфавиту. Чтобы расшифровать, нужно сдвинуть её обратно на 13 мест."
            },
            caesar: {
                title: "Шифр Цезаря",
                text: "Это как ROT13, но ты сам выбираешь, на сколько мест сдвинуть буквы. Это твой секретный ключ! Например, если сдвиг 3, 'А' станет 'Г'."
            },
            polybius: {
                title: "Шифр Полибия",
                text: "Представь, что буквы находятся в таблице, как в игре 'Морской бой'. Каждая буква превращается в пару цифр — её координаты в таблице. Например, буква 'А' может стать '11'."
            },
            zigzag: {
                title: "Зигзаг шифр",
                text: "Это шифр-змейка! Сообщение записывается в несколько рядов зигзагом, а потом буквы просто считываются по порядку, ряд за рядом."
            },
            vigenere: {
                title: "Шифр Виженера",
                text: "Для этого шифра нужен секретный ключ — слово. Каждая буква в твоём сообщении сдвигается на разное количество мест, которое зависит от буквы в ключе."
            },
            xor: {
                title: "XOR шифр",
                text: "Этот шифр смешивает каждую букву сообщения с буквой из пароля по специальному правилу. Это как если бы ты смешал два цвета, чтобы получить новый."
            },
            base64: {
                title: "Base64",
                text: "Это не совсем шифр, а скорее способ превратить сообщение в набор специальных символов, чтобы его можно было легко отправлять по сети. Например, картинки тоже часто превращаются в такой код."
            },
            aes128: {
                title: "Шифр AES (128-bit)",
                text: "Это очень надёжный шифр, который используют даже взрослые! Чтобы его расшифровать, нужен правильный пароль и очень мощный 'ключ' из 128 'битов'. Без пароля его почти невозможно взломать."
            },
            aes256: {
                title: "Шифр AES (256-bit)",
                text: "Ещё более сильная версия шифра AES. Его 'ключ' из 256 'битов' ещё сложнее подобрать, поэтому это один из самых безопасных способов спрятать секретное сообщение."
            },
            polyalphabetic: {
                title: "Полиалфавитный шифр",
                text: "Очень похож на шифр Виженера, но использует несколько разных алфавитов, чтобы запутать следы. Это делает шифровку ещё сложнее и интереснее!"
            }
        };

        // Обновление шифров
        function updateCiphers() {
            const text = msgInp.value;
            const pass = passInp.value;
            const shift = parseInt(caesarSlide.value);
            const zigzagRows = parseInt(zigzagSlide.value);
            const shiftDec = parseInt(caesarSlideDec.value);
            const zigzagRowsDec = parseInt(zigzagSlideDec.value);

            caesarVal.textContent = shift;
            zigzagVal.textContent = zigzagRows;
            caesarValDec.textContent = shiftDec;
            zigzagValDec.textContent = zigzagRowsDec;
            
            if (isEncrypting) {
                // Показываем секции шифрования и скрываем секцию расшифровки
                ciphersEnc.style.display = 'flex';
                ciphersDec.style.display = 'none';
                sectionHeader.textContent = "Зашифрованные сообщения";

                encryptLabel.classList.remove('text-gray-400');
                encryptLabel.classList.add('text-gray-800');
                decryptLabel.classList.remove('text-gray-800');
                decryptLabel.classList.add('text-gray-400');
                
                const reverseEnc = text.split('').reverse().join('');
                const atbashEnc = atbash(text);
                const rot13Enc = caesar(text, 13);
                const caesarEnc = caesar(text, shift);
                const polybiusEnc = polybius(text);
                const zigzagEnc = zigzag(text, zigzagRows);
                const vigenereEnc = vigenere(text, pass);
                const xorEnc = xor(text, pass);
                const base64Enc = toBase64(text);
                const aes128Enc = aesEncrypt(text, pass, 128);
                const aes256Enc = aesEncrypt(text, pass, 256);
                const polyalphabeticEnc = polyalphabetic(text, pass);
    
                reverseOut.textContent = reverseEnc;
                atbashOut.textContent = atbashEnc;
                rot13Out.textContent = rot13Enc;
                caesarOut.textContent = caesarEnc;
                polybiusOut.textContent = polybiusEnc;
                zigzagOut.textContent = zigzagEnc;
                vigenereOut.textContent = vigenereEnc;
                xorOut.textContent = xorEnc;
                base64Out.textContent = base64Enc;
                aes128Out.textContent = aes128Enc;
                aes256Out.textContent = aes256Enc;
                polyalphabeticOut.textContent = polyalphabeticEnc;
            } else {
                // Скрываем секции шифрования и показываем секцию расшифровки
                ciphersEnc.style.display = 'none';
                ciphersDec.style.display = 'flex';
                sectionHeader.textContent = "Расшифрованные сообщения";

                encryptLabel.classList.remove('text-gray-800');
                encryptLabel.classList.add('text-gray-400');
                decryptLabel.classList.remove('text-gray-400');
                decryptLabel.classList.add('text-gray-800');

                reverseDecOut.textContent = text.split('').reverse().join('');
                atbashDecOut.textContent = atbash(text);
                rot13DecOut.textContent = caesar(text, -13);
                caesarDecOut.textContent = caesar(text, -shiftDec);
                polybiusDecOut.textContent = polybiusDec(text);
                zigzagDecOut.textContent = zigzagDec(text, zigzagRowsDec);
                vigenereDecOut.textContent = vigenereDec(text, pass);
                xorDecOut.textContent = xor(text, pass);
                base64DecOut.textContent = fromBase64(text);
                aes128DecOut.textContent = aesDecrypt(text, pass, 128);
                aes256DecOut.textContent = aesDecrypt(text, pass, 256);
                polyalphabeticDecOut.textContent = polyalphabeticDec(text, pass);
            }
        }

        // ---------------------------------
        //           Функции шифрования
        // ---------------------------------
        function caesar(text, shift) {
            return text.split('').map(c => {
                const code = c.charCodeAt(0);
                if (code >= 65 && code <= 90) return String.fromCharCode(((code - 65 + shift + 26) % 26) + 65);
                if (code >= 97 && code <= 122) return String.fromCharCode(((code - 97 + shift + 26) % 26) + 97);
                if (code >= 1040 && code <= 1071) return String.fromCharCode(((code - 1040 + shift + 32) % 32) + 1040);
                if (code >= 1072 && code <= 1103) return String.fromCharCode(((code - 1072 + shift + 32) % 32) + 1072);
                return c;
            }).join('');
        }

        function atbash(text) {
            return text.split('').map(c => {
                const code = c.charCodeAt(0);
                if (code >= 65 && code <= 90) return String.fromCharCode(90 - (code - 65));
                if (code >= 97 && code <= 122) return String.fromCharCode(122 - (code - 97));
                if (code >= 1040 && code <= 1071) return String.fromCharCode(1071 - (code - 1040));
                if (code >= 1072 && code <= 1103) return String.fromCharCode(1103 - (code - 1072));
                return c;
            }).join('');
        }

        function vigenere(text, key) {
            const filteredKey = key.replace(/[^a-zA-Zа-яА-Я]/g, '').toUpperCase();
            if (!filteredKey) return text;

            let res = '';
            for (let i = 0, j = 0; i < text.length; i++) {
                const char = text[i];
                const code = char.charCodeAt(0);
                let shift = 0;
                let alphabetSize = 0;
                let base = 0;

                const keyChar = filteredKey[j % filteredKey.length];
                const key_code = keyChar.charCodeAt(0);
                
                if (code >= 65 && code <= 90) {
                    alphabetSize = 26;
                    base = 65;
                    if (key_code >= 65 && key_code <= 90) shift = key_code - 65;
                    res += String.fromCharCode(((code - base + shift) % alphabetSize) + base);
                    j++;
                } else if (code >= 97 && code <= 122) {
                    alphabetSize = 26;
                    base = 97;
                    if (key_code >= 65 && key_code <= 90) shift = key_code - 65;
                    res += String.fromCharCode(((code - base + shift) % alphabetSize) + base);
                    j++;
                } else if (code >= 1040 && code <= 1071) {
                    alphabetSize = 32;
                    base = 1040;
                    if (key_code >= 1040 && key_code <= 1071) shift = key_code - 1040;
                    res += String.fromCharCode(((code - base + shift) % alphabetSize) + base);
                    j++;
                } else if (code >= 1072 && code <= 1103) {
                    alphabetSize = 32;
                    base = 1072;
                    if (key_code >= 1040 && key_code <= 1071) shift = key_code - 1040;
                    res += String.fromCharCode(((code - base + shift) % alphabetSize) + base);
                    j++;
                } else {
                    res += char;
                }
            }
            return res;
        }
        
        function xor(text, pass) {
            if (!pass) return text;
            let res = '';
            for (let i = 0; i < text.length; i++) {
                const charCode = text.charCodeAt(i) ^ pass.charCodeAt(i % pass.length);
                res += String.fromCharCode(charCode);
            }
            return res;
        }

        function zigzag(text, rows) {
            if (rows <= 1) return text;
            const grid = Array.from({ length: rows }, () => []);
            let row = 0, direction = 1;
            for (let i = 0; i < text.length; i++) {
                grid[row].push(text[i]);
                row += direction;
                if (row === 0 || row === rows - 1) direction *= -1;
            }
            return grid.flat().join('');
        }

        function polybius(text) {
            const engTable = ['ABCDEF', 'GHIJKL', 'MNOPQR', 'STUVWX', 'YZ1234', '567890'];
            const rusTable = ['АБВГДЕЁ', 'ЖЗИЙКЛМ', 'НОПРСТУ', 'ФХЦЧШЩЪ', 'ЫЬЭЮЯ12', '34567890'];
            const res = [];
            text = text.toUpperCase();
            for (const c of text) {
                let found = false;
                for (let r = 0; r < engTable.length; r++) {
                    const col = engTable[r].indexOf(c);
                    if (col !== -1) {
                        res.push(`${r + 1}${col + 1}`);
                        found = true;
                        break;
                    }
                }
                if (found) continue;

                for (let r = 0; r < rusTable.length; r++) {
                    const col = rusTable[r].indexOf(c);
                    if (col !== -1) {
                        res.push(`${r + 1}${col + 1}`);
                        found = true;
                        break;
                    }
                }
                if (!found) res.push(c);
            }
            return res.join(' ');
        }
        
        function aesEncrypt(text, pass, keySize) {
            if (!pass) return "Введите пароль для AES шифра";
            try {
                return CryptoJS.AES.encrypt(text, pass, { keySize: keySize / 32 }).toString();
            } catch(e) {
                return "Ошибка шифрования AES";
            }
        }
        
        function toBase64(text) {
            if (!text) return '';
            return btoa(encodeURIComponent(text).replace(/%([0-9A-F]{2})/g,
                function toSolidBytes(match, p1) {
                    return String.fromCharCode('0x' + p1);
                }));
        }

        function polyalphabetic(text, key) {
            const filteredKey = key.replace(/[^a-zA-Zа-яА-Я]/g, '').toUpperCase();
            if (!filteredKey) return text;

            let res = '';
            for (let i = 0, j = 0; i < text.length; i++) {
                const char = text[i];
                const code = char.charCodeAt(0);
                let shift = 0;
                let alphabetSize = 0;
                let base = 0;

                const keyChar = filteredKey[j % filteredKey.length];
                const key_code = keyChar.charCodeAt(0);

                if (code >= 65 && code <= 90) {
                    alphabetSize = 26;
                    base = 65;
                    if (key_code >= 65 && key_code <= 90) shift = key_code - 65;
                    res += String.fromCharCode(((code - base + shift) % alphabetSize) + base);
                    j++;
                } else if (code >= 97 && code <= 122) {
                    alphabetSize = 26;
                    base = 97;
                    if (key_code >= 65 && key_code <= 90) shift = key_code - 65;
                    res += String.fromCharCode(((code - base + shift) % alphabetSize) + base);
                    j++;
                } else if (code >= 1040 && code <= 1071) {
                    alphabetSize = 32;
                    base = 1040;
                    if (key_code >= 1040 && key_code <= 1071) shift = key_code - 1040;
                    res += String.fromCharCode(((code - base + shift) % alphabetSize) + base);
                    j++;
                } else if (code >= 1072 && code <= 1103) {
                    alphabetSize = 32;
                    base = 1072;
                    if (key_code >= 1040 && key_code <= 1071) shift = key_code - 1040;
                    res += String.fromCharCode(((code - base + shift) % alphabetSize) + base);
                    j++;
                } else {
                    res += char;
                }
            }
            return res;
        }

        // ---------------------------------
        //           Функции расшифровки
        // ---------------------------------
        function vigenereDec(text, key) {
            const filteredKey = key.replace(/[^a-zA-Zа-яА-Я]/g, '').toUpperCase();
            if (!filteredKey) return text;

            let res = '';
            for (let i = 0, j = 0; i < text.length; i++) {
                const char = text[i];
                const code = char.charCodeAt(0);
                let shift = 0;
                let alphabetSize = 0;
                let base = 0;

                const keyChar = filteredKey[j % filteredKey.length];
                const key_code = keyChar.charCodeAt(0);

                if (code >= 65 && code <= 90) {
                    alphabetSize = 26;
                    base = 65;
                    if (key_code >= 65 && key_code <= 90) shift = key_code - 65;
                    res += String.fromCharCode(((code - base - shift + alphabetSize) % alphabetSize) + base);
                    j++;
                } else if (code >= 97 && code <= 122) {
                    alphabetSize = 26;
                    base = 97;
                    if (key_code >= 65 && key_code <= 90) shift = key_code - 65;
                    res += String.fromCharCode(((code - base - shift + alphabetSize) % alphabetSize) + base);
                    j++;
                } else if (code >= 1040 && code <= 1071) {
                    alphabetSize = 32;
                    base = 1040;
                    if (key_code >= 1040 && key_code <= 1071) shift = key_code - 1040;
                    res += String.fromCharCode(((code - base - shift + alphabetSize) % alphabetSize) + base);
                    j++;
                } else if (code >= 1072 && code <= 1103) {
                    alphabetSize = 32;
                    base = 1072;
                    if (key_code >= 1040 && key_code <= 1071) shift = key_code - 1040;
                    res += String.fromCharCode(((code - base - shift + alphabetSize) % alphabetSize) + base);
                    j++;
                } else {
                    res += char;
                }
            }
            return res;
        }

        function polybiusDec(text) {
            const engTable = ['ABCDEF', 'GHIJKL', 'MNOPQR', 'STUVWX', 'YZ1234', '567890'];
            const rusTable = ['АБВГДЕЁ', 'ЖЗИЙКЛМ', 'НОПРСТУ', 'ФХЦЧШЩЪ', 'ЫЬЭЮЯ12', '34567890'];
            const res = [];
            const pairs = text.split(' ').filter(p => p.length === 2);
            for (const p of pairs) {
                const row = parseInt(p[0]) - 1;
                const col = parseInt(p[1]) - 1;
                if (row >= 0 && col >= 0) {
                    let found = false;
                    if (row < engTable.length && col < engTable[row].length) {
                         res.push(engTable[row][col]);
                         found = true;
                    } 
                    if (!found && row < rusTable.length && col < rusTable[row].length) {
                        res.push(rusTable[row][col]);
                        found = true;
                    }
                    if (!found) res.push(p);
                } else {
                    res.push(p);
                }
            }
            return res.join('');
        }

        function zigzagDec(text, rows) {
            if (rows <= 1) return text;
            const len = text.length;
            const grid = Array.from({ length: rows }, () => Array(len).fill(null));
            let row = 0, direction = 1;
            let i = 0;

            for (let k = 0; k < len; k++) {
                grid[row][k] = '*';
                row += direction;
                if (row === 0 || row === rows - 1) direction *= -1;
            }

            let k = 0;
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < len; c++) {
                    if (grid[r][c] === '*') {
                        grid[r][c] = text[k++];
                    }
                }
            }

            row = 0; direction = 1;
            let result = '';
            for (let k = 0; k < len; k++) {
                result += grid[row][k];
                row += direction;
                if (row === 0 || row === rows - 1) direction *= -1;
            }
            return result;
        }
        
        function fromBase64(text) {
            if (!text) return '';
            try {
                return decodeURIComponent(atob(text).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
            } catch(e) {
                return "Ошибка декодирования Base64";
            }
        }
        
        function aesDecrypt(text, pass, keySize) {
            if (!pass) return "Введите пароль для AES шифра";
            try {
                const bytes  = CryptoJS.AES.decrypt(text, pass, { keySize: keySize / 32 });
                return bytes.toString(CryptoJS.enc.Utf8);
            } catch(e) {
                return "Ошибка расшифровки AES";
            }
        }

        function polyalphabeticDec(text, key) {
            const filteredKey = key.replace(/[^a-zA-Zа-яА-Я]/g, '').toUpperCase();
            if (!filteredKey) return text;
            
            let res = '';
            for (let i = 0, j = 0; i < text.length; i++) {
                const char = text[i];
                const code = char.charCodeAt(0);
                let shift = 0;
                let alphabetSize = 0;
                let base = 0;
                
                const keyChar = filteredKey[j % filteredKey.length];
                const key_code = keyChar.charCodeAt(0);
                
                if (code >= 65 && code <= 90) {
                    alphabetSize = 26;
                    base = 65;
                    if (key_code >= 65 && key_code <= 90) shift = key_code - 65;
                    res += String.fromCharCode(((code - base - shift + alphabetSize) % alphabetSize) + base);
                    j++;
                } else if (code >= 97 && code <= 122) {
                    alphabetSize = 26;
                    base = 97;
                    if (key_code >= 65 && key_code <= 90) shift = key_code - 65;
                    res += String.fromCharCode(((code - base - shift + alphabetSize) % alphabetSize) + base);
                    j++;
                } else if (code >= 1040 && code <= 1071) {
                    alphabetSize = 32;
                    base = 1040;
                    if (key_code >= 1040 && key_code <= 1071) shift = key_code - 1040;
                    res += String.fromCharCode(((code - base - shift + alphabetSize) % alphabetSize) + base);
                    j++;
                } else if (code >= 1072 && code <= 1103) {
                    alphabetSize = 32;
                    base = 1072;
                    if (key_code >= 1040 && key_code <= 1071) shift = key_code - 1040;
                    res += String.fromCharCode(((code - base - shift + alphabetSize) % alphabetSize) + base);
                    j++;
                } else {
                    res += char;
                }
            }
            return res;
        }

        // ---------------------------------
        //           Вспомогательные функции
        // ---------------------------------
        function copyAll() {
            let outputText = '';
            if (isEncrypting) {
                const encryptedText = document.getElementById('ciphers-enc').innerText;
                outputText = encryptedText;
            } else {
                const decryptedText = document.getElementById('ciphers-dec').innerText;
                outputText = decryptedText;
            }
            
            const textarea = document.createElement('textarea');
            textarea.value = outputText;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        
        function clearAll() {
            msgInp.value = '';
            passInp.value = '';
            modeSwitch.checked = false;
            isEncrypting = true;
            updateCiphers();
        }

        // Обработчики событий для переключателя
        modeSwitch.addEventListener('change', () => {
            isEncrypting = !modeSwitch.checked;
            updateCiphers();
        });

        // Обработчики событий для модального окна
        infoBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const cipher = btn.getAttribute('data-cipher');
                const info = cipherExplanations[cipher];
                if (info) {
                    modalTitle.textContent = info.title;
                    modalText.textContent = info.text;
                    infoModal.style.display = 'flex';
                }
            });
        });

        closeModalBtn.addEventListener('click', () => {
            infoModal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target === infoModal) {
                infoModal.style.display = 'none';
            }
        });

        // Обработчики событий
        msgInp.addEventListener('input', updateCiphers);
        passInp.addEventListener('input', updateCiphers);
        caesarSlide.addEventListener('input', updateCiphers);
        zigzagSlide.addEventListener('input', updateCiphers);
        caesarSlideDec.addEventListener('input', updateCiphers);
        zigzagSlideDec.addEventListener('input', updateCiphers);

        // Инициализация при загрузке
        window.onload = () => {
            modeSwitch.checked = false;
            updateCiphers();
        };

    </script>
</body>
</html>
